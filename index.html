<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–ª—å—Ü–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 25px;
        }

        h2, h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .photo-upload {
            margin-top: 10px;
        }

        .btn-photo {
            background: #ecf0f1;
            border: 1px dashed #bdc3c7;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-photo:hover {
            background: #d5dbdb;
            border-color: #95a5a6;
        }

        .photo-preview {
            margin-top: 15px;
        }

        .photo-preview-item {
            position: relative;
            display: inline-block;
            margin-right: 10px;
        }

        .photo-preview-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .photo-preview-item button {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .loading-spinner .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            width: 40px;
            height: 40px;
            margin-bottom: 15px;
        }

        .resident-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
            transition: background 0.2s;
        }

        .resident-item:hover {
            background: #f8f9fa;
        }

        .resident-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            border: 2px solid #eee;
        }

        .resident-info {
            flex: 1;
        }

        .resident-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .resident-details {
            display: flex;
            gap: 15px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .resident-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-inactive {
            background: #fadbd8;
            color: #e74c3c;
        }

        .resident-actions {
            display: flex;
            gap: 10px;
        }

        .resident-actions button {
            padding: 6px 12px;
            font-size: 14px;
        }

        .house-section {
            margin-bottom: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            overflow: hidden;
        }

        .house-header {
            background: #f8f9fa;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .house-header:hover {
            background: #e9ecef;
        }

        .house-name {
            font-weight: 600;
            font-size: 18px;
            color: #2c3e50;
        }

        .resident-count {
            color: #7f8c8d;
            font-size: 14px;
        }

        .expand-icon {
            color: #7f8c8d;
            font-size: 18px;
        }

        .residents-list {
            padding: 0;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state img {
            width: 100px;
            opacity: 0.5;
            margin-bottom: 15px;
        }

        .message {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .message.success {
            background: #d5f4e6;
            color: #27ae60;
            border: 1px solid #a3e4bf;
        }

        .message.error {
            background: #fadbd8;
            color: #e74c3c;
            border: 1px solid #f5b7b1;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-buttons {
                flex-direction: column;
            }
            
            .resident-details {
                flex-direction: column;
                gap: 5px;
            }
            
            .resident-actions {
                flex-direction: column;
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div>
            <div class="card">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∂–∏–ª—å—Ü–∞</h2>
                
                <div id="messageContainer"></div>
                
                <form id="residentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">–ò–º—è:</label>
                            <input type="text" id="firstName" name="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">–§–∞–º–∏–ª–∏—è:</label>
                            <input type="text" id="lastName" name="lastName" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="house">–î–æ–º:</label>
                            <select id="house" name="house" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="apartment">–ö–≤–∞—Ä—Ç–∏—Ä–∞:</label>
                            <input type="text" id="apartment" name="apartment">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–§–æ—Ç–æ:</label>
                        <div class="photo-upload">
                            <input type="file" id="photo" name="photo" accept="image/*" style="display: none;">
                            <button type="button" class="btn-photo" id="photoBtn">
                                üì∑ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
                            </button>
                            <div id="photoPreview" class="photo-preview"></div>
                        </div>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <span class="btn-text">–ó–∞—Å–µ–ª–∏—Ç—å</span>
                            <div class="spinner hidden" id="submitSpinner"></div>
                        </button>
                        <button type="button" class="btn btn-secondary" id="clearBtn">
                            –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Å–ø–∏—Å–æ–∫ –∂–∏–ª—å—Ü–æ–≤ -->
        <div>
            <div class="card">
                <h2>–°–ø–∏—Å–æ–∫ –∂–∏–ª—å—Ü–æ–≤</h2>
                
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <span>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </div>

                <div id="residentsContainer">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∂–∏–ª—å—Ü–æ–≤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content">
            <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∂–∏–ª—å—Ü–∞</h3>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editFirstName">–ò–º—è:</label>
                        <input type="text" id="editFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="editLastName">–§–∞–º–∏–ª–∏—è:</label>
                        <input type="text" id="editLastName" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" id="editPhone">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editHouse">–î–æ–º:</label>
                        <select id="editHouse" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editApartment">–ö–≤–∞—Ä—Ç–∏—Ä–∞:</label>
                        <input type="text" id="editApartment">
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" id="cancelEditBtn">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class ResidentManager {
            constructor() {
                this.residents = [];
                this.houses = [];
                this.expandedHouses = new Set();
                this.selectedPhoto = null;
                this.editPhoto = null;
                this.init();
            }

            async init() {
                this.showSpinner('loadingSpinner');
                try {
                    await Promise.all([
                        this.loadHouses(),
                        this.loadResidents()
                    ]);
                } catch (error) {
                    this.showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                } finally {
                    this.hideSpinner('loadingSpinner');
                }
                this.setupEventListeners();
                this.renderResidentsList();
            }

            async loadHouses() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
                await new Promise(resolve => setTimeout(resolve, 1000));
                this.houses = [
                    { id: 1, name: '–î–æ–º 1' },
                    { id: 2, name: '–î–æ–º 2' },
                    { id: 3, name: '–ö–æ—Ä–ø—É—Å –ê' },
                    { id: 4, name: '–ö–æ—Ä–ø—É—Å –ë' }
                ];
                this.renderHouseSelect();
            }

            async loadResidents() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ localStorage
                const savedResidents = localStorage.getItem('residents');
                if (savedResidents) {
                    this.residents = JSON.parse(savedResidents);
                } else {
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    this.residents = [
                        {
                            id: 1,
                            firstName: '–ò–≤–∞–Ω',
                            lastName: '–ü–µ—Ç—Ä–æ–≤',
                            phone: '+7 123 456-78-90',
                            houseId: 1,
                            apartment: '25',
                            status: 'active',
                            photo: null
                        },
                        {
                            id: 2,
                            firstName: '–ú–∞—Ä–∏—è',
                            lastName: '–°–∏–¥–æ—Ä–æ–≤–∞',
                            phone: '+7 987 654-32-10',
                            houseId: 2,
                            apartment: '14',
                            status: 'active',
                            photo: null
                        },
                        {
                            id: 3,
                            firstName: '–ê–ª–µ–∫—Å–µ–π',
                            lastName: '–ö–æ–∑–ª–æ–≤',
                            phone: '+7 555 123-45-67',
                            houseId: 1,
                            apartment: '38',
                            status: 'inactive',
                            photo: null
                        }
                    ];
                    this.saveResidents();
                }
            }

            saveResidents() {
                localStorage.setItem('residents', JSON.stringify(this.residents));
            }

            renderHouseSelect() {
                const select = document.getElementById('house');
                const editSelect = document.getElementById('editHouse');
                
                [select, editSelect].forEach(sel => {
                    sel.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º</option>';
                    this.houses.forEach(house => {
                        const option = document.createElement('option');
                        option.value = house.id;
                        option.textContent = house.name;
                        sel.appendChild(option);
                    });
                });
            }

            setupEventListeners() {
                document.getElementById('residentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.registerResident();
                });

                document.getElementById('editForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateResident();
                });

                document.getElementById('clearBtn').addEventListener('click', () => {
                    this.clearForm();
                });

                document.getElementById('photoBtn').addEventListener('click', () => {
                    document.getElementById('photo').click();
                });

                document.getElementById('photo').addEventListener('change', (e) => {
                    this.handlePhotoSelect(e, 'selectedPhoto', 'photoPreview');
                });

                document.getElementById('cancelEditBtn').addEventListener('click', () => {
                    this.closeModal();
                });
            }

            handlePhotoSelect(event, property, previewId) {
                const file = event.target.files[0];
                if (file) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        this.showMessage('–§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 2MB', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this[property] = e.target.result;
                        this.showPhotoPreview(this[property], previewId);
                    };
                    reader.readAsDataURL(file);
                }
            }

            showPhotoPreview(photoData, previewId) {
                const preview = document.getElementById(previewId);
                preview.innerHTML = `
                    <div class="photo-preview-item">
                        <img src="${photoData}" alt="Preview">
                        <button type="button" onclick="residentManager.removePhoto('${previewId}')">√ó</button>
                    </div>
                `;
            }

            removePhoto(previewId) {
                if (previewId === 'photoPreview') {
                    this.selectedPhoto = null;
                    document.getElementById('photo').value = '';
                } else {
                    this.editPhoto = null;
                }
                document.getElementById(previewId).innerHTML = '';
            }

            async registerResident() {
                const formData = new FormData(document.getElementById('residentForm'));
                const submitBtn = document.getElementById('submitBtn');
                const spinner = document.getElementById('submitSpinner');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
                submitBtn.disabled = true;
                spinner.classList.remove('hidden');
                document.querySelector('#submitBtn .btn-text').textContent = '–ó–∞—Å–µ–ª–µ–Ω–∏–µ...';

                try {
                    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    const residentData = {
                        id: Date.now(), // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏
                        firstName: formData.get('firstName'),
                        lastName: formData.get('lastName'),
                        phone: formData.get('phone'),
                        houseId: parseInt(formData.get('house')),
                        apartment: formData.get('apartment'),
                        photo: this.selectedPhoto,
                        status: 'active'
                    };

                    // –í–∞–ª–∏–¥–∞—Ü–∏—è
                    if (!residentData.firstName || !residentData.lastName || !residentData.houseId) {
                        throw new Error('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                    }

                    // –î–æ–±–∞–≤–ª—è–µ–º –∂–∏–ª—å—Ü–∞
                    this.residents.push(residentData);
                    this.saveResidents();

                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    this.renderResidentsList();
                    this.clearForm();
                    this.showMessage('–ñ–∏–ª–µ—Ü —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                    this.showMessage(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∂–∏–ª—å—Ü–∞', 'error');
                } finally {
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
                    submitBtn.disabled = false;
                    spinner.classList.add('hidden');
                    document.querySelector('#submitBtn .btn-text').textContent = '–ó–∞—Å–µ–ª–∏—Ç—å';
                }
            }

            clearForm() {
                document.getElementById('residentForm').reset();
                this.selectedPhoto = null;
                document.getElementById('photoPreview').innerHTML = '';
            }

            renderResidentsList() {
                const container = document.getElementById('residentsContainer');
                
                if (this.residents.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div>üìã</div>
                            <p>–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∂–∏–ª—å—Ü–æ–≤</p>
                        </div>
                    `;
                    return;
                }

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∂–∏–ª—å—Ü–æ–≤ –ø–æ –¥–æ–º–∞–º
                const residentsByHouse = {};
                this.residents.forEach(resident => {
                    if (!residentsByHouse[resident.houseId]) {
                        residentsByHouse[resident.houseId] = [];
                    }
                    residentsByHouse[resident.houseId].push(resident);
                });

                let html = '';
                let hasResidents = false;

                this.houses.forEach(house => {
                    const houseResidents = residentsByHouse[house.id] || [];
                    if (houseResidents.length === 0) return;

                    hasResidents = true;
                    const isExpanded = this.expandedHouses.has(house.id);
                    const activeCount = houseResidents.filter(r => r.status === 'active').length;
                    const totalCount = houseResidents.length;

                    html += `
                        <div class="house-section">
                            <div class="house-header" onclick="residentManager.toggleHouse(${house.id})">
                                <span class="house-name">${house.name}</span>
                                <span class="resident-count">${activeCount}/${totalCount} –∂–∏–ª—å—Ü–æ–≤</span>
                                <span class="expand-icon">${isExpanded ? '‚ñº' : '‚ñ∂'}</span>
                            </div>
                            ${isExpanded ? this.renderHouseResidents(houseResidents) : ''}
                        </div>
                    `;
                });

                container.innerHTML = hasResidents ? html : `
                    <div class="empty-state">
                        <div>üìã</div>
                        <p>–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∂–∏–ª—å—Ü–æ–≤</p>
                    </div>
                `;
            }

            renderHouseResidents(residents) {
                return `
                    <div class="residents-list">
                        ${residents.map(resident => `
                            <div class="resident-item">
                                <img src="${resident.photo || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDExQzE0LjIwOTEgMTEgMTYgOS4yMDkxIDE2IDdDMTYgNC43OTA4NiAxNC4yMDkxIDMgMTIgM0M5Ljc5MDg2IDMgOCA0Ljc5MDg2IDggN0M4IDkuMjA5MTQgOS43OTA4NiAxMSAxMiAxMVoiIGZpbGw9IiM5OTk5OTkiLz4KPHBhdGggZD0iTTEyIDEzQzcuNTgxNzIgMTMgNCAxNS4zNTgzIDQgMThWMjBIMjBWMThDMjAgMTUuMzU4MyAxNi40MTgyIDEzIDEyIDEzWiIgZmlsbD0iIzk5OTk5OSIvPgo8L3N2Zz4K'}" 
                                     alt="${resident.firstName} ${resident.lastName}" class="resident-photo">
                                <div class="resident-info">
                                    <div class="resident-name">${resident.firstName} ${resident.lastName}</div>
                                    <div class="resident-details">
                                        <span>–ö–≤. ${resident.apartment || '–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</span>
                                        ${resident.phone ? `<span>–¢–µ–ª: ${resident.phone}</span>` : ''}
                                        <span class="resident-status ${resident.status === 'active' ? 'status-active' : 'status-inactive'}">
                                            ${resident.status === 'active' ? '–ü—Ä–æ–∂–∏–≤–∞–µ—Ç' : '–í—ã—Å–µ–ª–µ–Ω'}
                                        </span>
                                    </div>
                                </div>
                                <div class="resident-actions">
                                    <button class="btn btn-primary" onclick="residentManager.openEditModal(${resident.id})">
                                        –ò–∑–º–µ–Ω–∏—Ç—å
                                    </button>
                                    <button class="btn ${resident.status === 'active' ? 'btn-danger' : 'btn-secondary'}" 
                                            onclick="residentManager.toggleResidentStatus(${resident.id})">
                                        ${resident.status === 'active' ? '–í—ã—Å–µ–ª–∏—Ç—å' : '–ó–∞—Å–µ–ª–∏—Ç—å'}
                                    </button>
                                    <button class="btn btn-danger" onclick="residentManager.deleteResident(${resident.id})">
                                        –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            toggleHouse(houseId) {
                if (this.expandedHouses.has(houseId)) {
                    this.expandedHouses.delete(houseId);
                } else {
                    this.expandedHouses.add(houseId);
                }
                this.renderResidentsList();
            }

            openEditModal(residentId) {
                const resident = this.residents.find(r => r.id === residentId);
                if (!resident) return;

                document.getElementById('editId').value = resident.id;
                document.getElementById('editFirstName').value = resident.firstName;
                document.getElementById('editLastName').value = resident.lastName;
                document.getElementById('editPhone').value = resident.phone || '';
                document.getElementById('editHouse').value = resident.houseId;
                document.getElementById('editApartment').value = resident.apartment || '';
                
                this.editPhoto = resident.photo;
                if (this.editPhoto) {
                    this.showPhotoPreview(this.editPhoto, 'editPhotoPreview');
                } else {
                    document.getElementById('editPhotoPreview').innerHTML = '';
                }

                document.getElementById('editModal').classList.remove('hidden');
            }

            closeModal() {
                document.getElementById('editModal').classList.add('hidden');
                this.editPhoto = null;
            }

            async updateResident() {
                const id = parseInt(document.getElementById('editId').value);
                const resident = this.residents.find(r => r.id === id);
                if (!resident) return;

                try {
                    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                    await new Promise(resolve => setTimeout(resolve, 1000));

                    resident.firstName = document.getElementById('editFirstName').value;
                    resident.lastName = document.getElementById('editLastName').value;
                    resident.phone = document.getElementById('editPhone').value;
                    resident.houseId = parseInt(document.getElementById('editHouse').value);
                    resident.apartment = document.getElementById('editApartment').value;
                    
                    if (this.editPhoto !== undefined) {
                        resident.photo = this.editPhoto;
                    }

                    this.saveResidents();
                    this.renderResidentsList();
                    this.closeModal();
                    this.showMessage('–î–∞–Ω–Ω—ã–µ –∂–∏–ª—å—Ü–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
                    this.showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                }
            }

            async toggleResidentStatus(residentId) {
                const resident = this.residents.find(r => r.id === residentId);
                if (!resident) return;

                try {
                    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                    await new Promise(resolve => setTimeout(resolve, 800));

                    resident.status = resident.status === 'active' ? 'inactive' : 'active';
                    this.saveResidents();
                    this.renderResidentsList();
                    
                    const action = resident.status === 'active' ? '–∑–∞—Å–µ–ª–µ–Ω' : '–≤—ã—Å–µ–ª–µ–Ω';
                    this.showMessage(`–ñ–∏–ª–µ—Ü ${action}`, 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                    this.showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            }

            async deleteResident(residentId) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∂–∏–ª—å—Ü–∞?')) {
                    return;
                }

                try {
                    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                    await new Promise(resolve => setTimeout(resolve, 800));

                    this.residents = this.residents.filter(r => r.id !== residentId);
                    this.saveResidents();
                    this.renderResidentsList();
                    this.showMessage('–ñ–∏–ª–µ—Ü —É–¥–∞–ª–µ–Ω', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                    this.showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∂–∏–ª—å—Ü–∞', 'error');
                }
            }

            showSpinner(id) {
                document.getElementById(id).classList.remove('hidden');
            }

            hideSpinner(id) {
                document.getElementById(id).classList.add('hidden');
            }

            showMessage(text, type) {
                const messageContainer = document.getElementById('messageContainer');
                const message = document.createElement('div');
                message.className = `message ${type}`;
                message.textContent = text;
                messageContainer.appendChild(message);
                
                setTimeout(() => {
                    message.remove();
                }, 5000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            window.residentManager = new ResidentManager();
        });
    </script>
</body>
</html>
